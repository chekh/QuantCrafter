# 🧭 Общее описание проекта

**Название проекта:** *QuantCrafter*

**Цель:**
Разработка кросс-платформенной системы для построения, тестирования и исполнения торговых алгоритмов на основе декларативных конфигураций. Поддержка стратегий из модулей («кубиков»), разделения сигналов и бизнес-логики исполнения, универсального контекста и инструментов визуализации.

---

# ⚙️ Основные особенности

| Компонент                               | Описание                                                                                             |
| --------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| **Декларативная стратегия**             | Поведение стратегии описывается в YAML-конфиге без необходимости писать код                          |
| **Модульность**                         | Стратегия собирается из независимых компонентов: индикаторы, фильтры, сигналогенераторы, исполнители |
| **Разделение сигналов и бизнес-логики** | Советники (advisors) отвечают за сигналы, а исполнение, риск и мани-менеджмент реализованы отдельно  |
| **Контекст исполнения**                 | Универсальный объект `StrategyContext` используется во всех модулях для доступа к состоянию          |
| **Визуализация**                        | Гибкий инструмент для визуализации индикаторов, сигналов, сделок, PnL, drawdown и других метрик      |
| **Кросс-средовая поддержка**            | Возможность запуска локально (разработчик, трейдер) и в облаке (backtesting farm, бот-хостинг)       |

---

# 🧱 Архитектура системы

## 🔲 1. Основные уровни

```
┌────────────────────────────────────────┐
│        Web-интерфейс и CLI             │
└────────────────────────────────────────┘
                ↓
┌────────────────────────────────────────┐
│         Оркестратор стратегии          │
│ (загрузка YAML, конфигурация, запуск)  │
└────────────────────────────────────────┘
                ↓
┌────────────────────────────────────────┐
│        Исполнительный цикл (Engine)    │
│  → генерация сигналов                  │
│  → фильтрация                          │
│  → исполнение сделок                   │
└────────────────────────────────────────┘
                ↓
┌────────────────────────────────────────┐
│         Компоненты стратегии           │
│  ├─ Advisors                           │
│  ├─ Filters                            │
│  ├─ ExecutionLogic                     │
│  ├─ RiskManager                        │
│  ├─ MoneyManager                       │
└────────────────────────────────────────┘
                ↓
┌────────────────────────────────────────┐
│     StrategyContext (единый доступ)    │
└────────────────────────────────────────┘
                ↓
┌────────────────────────────────────────┐
│   Источники данных и брокеры (Abstraction Layer) │
└────────────────────────────────────────┘
```

---

## 📚 2. Модули

### 🧩 Orchestrator

* Загружает конфиг из YAML.
* Создаёт инстансы всех компонентов стратегии.
* Управляет временем и режимом (`backtest`, `paper`, `live`).
* Делегирует логику в `ExecutionEngine`.

---

### 🚀 ExecutionEngine

Основной цикл:

1. Обновление контекста.
2. Генерация сигналов.
3. Применение фильтров.
4. Вызов исполнителя.
5. Логирование и визуализация.

---

### 🧠 Advisors (Советники)

* Генерируют торговые сигналы на основе индикаторов и данных.
* Используют `StrategyContext`.
* Поддерживают переиспользуемые конфигурации.

---

### 🧰 Filters

* Проверяют возможность исполнения сигналов.
* Примеры: временные ограничения, волатильность, экономические события.
* Объединяются в группы (например, `block`, `trade`).

---

### ⚖️ ExecutionLogic

* Управляет исполнением сигналов (открытие, закрытие, реверсы, сетки).
* Поддерживает разные типы ордеров (маркет, лимит).

---

### 📉 RiskManager

* Контролирует уровни Stop Loss, Take Profit.
* Ограничивает риски по капиталу и просадкам.
* Реализует различные стратегии управления риском.

---

### 💰 MoneyManager

* Вычисляет объёмы позиций на основе капитала и истории.
* Стратегии: фиксированные, мартингейл, анти-мартингейл.

---

### 🧱 StrategyContext

* Центральный объект состояния.
* Включает модули для данных рынка, индикаторов, позиций, портфеля, рисков, календаря и сигналов.

---

### 🧾 DataProviders / Brokers

* Абстракция над источниками данных и брокерскими API.
* Поддержка различных форматов и протоколов.

---

### 📊 Visualization Engine

* Отображение индикаторов, сигналов, сделок, PnL и статистики.
* Интеграция с Plotly, Matplotlib, Dash, Streamlit.

---

🔌 Расширяемость через систему плагинов (Pluggy)
Платформа QuantCrafter поддерживает расширение функциональности без модификации ядра за счёт интеграции системы плагинов, реализованной с использованием фреймворка Pluggy. Это обеспечивает структурированную, типизированную и безопасную модель расширения, подходящую как для внутренней разработки, так и для подключения сторонних модулей.

🧱 Основные свойства плагинной архитектуры
🔒 Контрактная модель через HookSpec/HookImpl
Расширения реализуют строго определённые интерфейсы, обеспечивая типовую совместимость и стабильность поведения.

⚙️ Автоматическое обнаружение плагинов через entry points
Установленные модули, объявляющие entry_points в секции quantcrafter.plugins, автоматически загружаются при старте платформы.

🧩 Гибкая регистрация компонентов
Поддерживаются произвольные типы плагинов: Advisors, Filters, Executors, Brokers, Strategies и другие.

📦 Интеграция с YAML-конфигурациями
Названия зарегистрированных плагинов используются напрямую в YAML без необходимости ручного импорта.

🧪 Изоляция и контроль совместимости
Плагины независимы от ядра, легко отключаются и тестируются изолированно.

🔁 Цикл подключения плагина
Разработчик реализует класс, соответствующий hookspec (например, register_advisors()).

Использует @hookimpl для регистрации реализации.

Указывает модуль как entry point (quantcrafter.plugins) в pyproject.toml или setup.py.

Устанавливает плагин в окружение через pip install plugin_name.

При запуске QuantCrafter загрузчик (Pluggy.PluginManager) выполняет:

Поиск entry points;

Загрузку модулей;

Вызов всех зарегистрированных хуков;

Регистрацию компонентов в реестрах (ADVISOR_REGISTRY, FILTER_REGISTRY, и др.).

Конфигурации YAML могут ссылаться на новые компоненты по имени плагина.

📈 Преимущества подхода
Преимущество	Описание
🔌 Простота расширения	Добавление функциональности без правки ядра
✅ Типизация и проверка интерфейсов	Контрактная модель исключает несовместимости
🔄 Горячая подгрузка	Автоматическая регистрация при старте
🧩 Эко-система модулей	Внешние и внутренние команды могут разрабатывать расширения параллельно
🛠️ Потенциал UI	Возможность создания GUI для управления плагинами

---

# 🗂 Глоссарий терминов

| Термин              | Описание                                                 |
| ------------------- | -------------------------------------------------------- |
| **Advisors**        | Модули генерации торговых сигналов                       |
| **Filters**         | Модули фильтрации сигналов для проверки условий торговли |
| **ExecutionLogic**  | Логика исполнения торговых сигналов                      |
| **RiskManager**     | Модуль управления рисками и ограничениями                |
| **MoneyManager**    | Модуль управления размером позиций                       |
| **StrategyContext** | Централизованный объект состояния и данных стратегии     |
| **Orchestrator**    | Компонент загрузки конфигураций и управления выполнением |
| **DataProviders**   | Источники рыночных данных и API брокеров                 |

---

# 🔧 Технические характеристики (кратко)

| Компонент     | Технология                       |
| ------------- | -------------------------------- |
| Язык          | Python 3.11+                     |
| Сериализация  | Pydantic (`BaseModel`) + YAML    |
| Архитектура   | Модульный монолит / DDD          |
| Очереди задач | Celery / aio-pika (при облаке)   |
| CI/CD         | Docker + GitHub Actions / Pulumi |
| Визуализация  | Plotly / Dash / Streamlit        |
| Тестирование  | `pytest` + `hypothesis`          |

---

# 📈 Поддерживаемые режимы

| Режим      | Описание                                             |
| ---------- | ---------------------------------------------------- |
| `backtest` | Запуск стратегии на исторических данных              |
| `paper`    | "Песочница" в реальном времени без исполнения сделок |
| `live`     | Торговля через подключённого брокера                 |
| `replay`   | Повтор торгового дня/сессии для анализа              |

---

# 🧩 Перспективы развития и расширения

* Интеграция с reinforcement learning агентами.
* Автоматическая оптимизация параметров стратегии.
* Интеграция с мессенджерами для оповещений.
* Визуальный редактор стратегий и drag-n-drop конструктор.

